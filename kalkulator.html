<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xizmat Tanlash</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="top-bar">
    <h2 id="title">Kalkulyator</h2>
    <div class="controls">
      <button class="toggle-lang" onclick="toggleLang()">üá∫üáø/üá∑üá∫</button>
      <button class="toggle-mode" onclick="toggleMode()">üåô</button>
    </div>
  </div>

  <div class="menu" id="mainMenu">
    <h2 id="menuTitle">Xizmatni tanlang:</h2>
    <button onclick="showSection('calc')">üî¢ Kalkulyator</button>
    <button onclick="showSection('convert')">üí± Valyuta Konvertori</button>
  </div>

  <div class="calculator" id="calculator" style="display:none;">
    <h2 id="title">Kalkulyator</h2>
    <input type="number" id="num1" placeholder="1-son" />
    <input type="number" id="num2" placeholder="2-son" />
    <select id="operation">
      <option value="add">‚ûï Qo‚Äòshish</option>
      <option value="subtract">‚ûñ Ayirish</option>
      <option value="multiply">‚úñÔ∏è Ko‚Äòpaytirish</option>
      <option value="divide">‚ûó Bo‚Äòlish</option>
    </select>
    <button onclick="calculate()" id="calculateBtn">Hisobla</button>
    <div id="result" class="result"></div>
    <div id="history" class="history"></div>
    <button onclick="clearHistory()">üßπ Tarixni tozalash</button>
    <button onclick="backToMenu()">‚¨ÖÔ∏è Ortga</button>
  </div>

  <div class="calculator" id="converter" style="display:none;">
    <h2 id="converterTitle">Valyuta Konvertori</h2>
    <input type="number" id="amount" placeholder="Miqdor" />
    <select id="fromCurrency"></select>
    <select id="toCurrency"></select>
    <button onclick="convertCurrency()">Konvertatsiya</button>
    <div id="convertedResult" class="result"></div>
    <div id="topRates" class="history"></div>
    <button onclick="backToMenu()">‚¨ÖÔ∏è Ortga</button>
  </div>

  <div class="footer" id="footer">Created by Khamidkhanov Muhammadzohid</div>
  <audio id="clickSound" src="click.mp3" preload="auto"></audio>

  <script>
    let currentLang = 'uz';
    const sound = document.getElementById("clickSound");
    const historyArr = [];
    let exchangeRates = {};

    async function fetchRates() {
      const response = await fetch('https://v6.exchangerate-api.com/v6/b619ef166163799d5ee3d2b9/latest/USD');
      const data = await response.json();
      exchangeRates = data.conversion_rates;
      populateCurrencyDropdowns();
      showTopRates();
    }

    function populateCurrencyDropdowns() {
      const fromSelect = document.getElementById("fromCurrency");
      const toSelect = document.getElementById("toCurrency");
      fromSelect.innerHTML = toSelect.innerHTML = "";
      for (let code in exchangeRates) {
        fromSelect.innerHTML += `<option value="${code}">${code}</option>`;
        toSelect.innerHTML += `<option value="${code}">${code}</option>`;
      }
      fromSelect.value = 'UZS';
      toSelect.value = 'USD';
    }

    function showTopRates() {
      const topDiv = document.getElementById("topRates");
      let top10 = Object.entries(exchangeRates).slice(0, 10);
      topDiv.innerHTML = `<strong>Top 10 kurslar (USD asosida):</strong><br>` +
        top10.map(([code, rate]) => `${code}: ${rate}`).join("<br>");
    }

    function toggleMode() {
      document.body.classList.toggle("dark-mode");
    }

    function toggleLang() {
      currentLang = currentLang === 'uz' ? 'ru' : 'uz';
      document.getElementById('menuTitle').textContent = currentLang === 'uz' ? 'Xizmatni tanlang:' : '–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:';
      document.getElementById('title').textContent = currentLang === 'uz' ? 'Kalkulyator' : '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä';
      document.getElementById('converterTitle').textContent = currentLang === 'uz' ? 'Valyuta Konvertori' : '–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –í–∞–ª—é—Ç';
      document.getElementById('num1').placeholder = currentLang === 'uz' ? '1-son' : '1-—á–∏—Å–ª–æ';
      document.getElementById('num2').placeholder = currentLang === 'uz' ? '2-son' : '2-—á–∏—Å–ª–æ';
      document.getElementById('calculateBtn').textContent = currentLang === 'uz' ? 'Hisobla' : '–í—ã—á–∏—Å–ª–∏—Ç—å';
      document.getElementById('amount').placeholder = currentLang === 'uz' ? 'Miqdor' : '–°—É–º–º–∞';
      document.getElementById('footer').textContent = currentLang === 'uz' ? 'Created by Khamidkhanov Muhammadzohid' : '–°–æ–∑–¥–∞–Ω–æ: –•–∞–º–∏–¥—Ö–∞–Ω–æ–≤ –ú—É—Ö–∞–º–º–∞–¥–∑–æ—Ö–∏–¥';
      const op = document.getElementById('operation').options;
      op[0].text = currentLang === 'uz' ? '‚ûï Qo‚Äòshish' : '‚ûï –°–ª–æ–∂–µ–Ω–∏–µ';
      op[1].text = currentLang === 'uz' ? '‚ûñ Ayirish' : '‚ûñ –í—ã—á–∏—Ç–∞–Ω–∏–µ';
      op[2].text = currentLang === 'uz' ? '‚úñÔ∏è Ko‚Äòpaytirish' : '‚úñÔ∏è –£–º–Ω–æ–∂–µ–Ω–∏–µ';
      op[3].text = currentLang === 'uz' ? '‚ûó Bo‚Äòlish' : '‚ûó –î–µ–ª–µ–Ω–∏–µ';
    }

    function showSection(type) {
      document.getElementById("mainMenu").style.display = "none";
      document.getElementById("calculator").style.display = type === 'calc' ? "block" : "none";
      document.getElementById("converter").style.display = type === 'convert' ? "block" : "none";
    }

    function backToMenu() {
      document.getElementById("mainMenu").style.display = "block";
      document.getElementById("calculator").style.display = "none";
      document.getElementById("converter").style.display = "none";
    }

    async function calculate() {
      try { await sound.play(); } catch {}
      const num1 = parseFloat(document.getElementById("num1").value);
      const num2 = parseFloat(document.getElementById("num2").value);
      const op = document.getElementById("operation").value;
      let result;
      switch(op) {
        case 'add': result = num1 + num2; break;
        case 'subtract': result = num1 - num2; break;
        case 'multiply': result = num1 * num2; break;
        case 'divide': result = num2 !== 0 ? num1 / num2 : '‚àû'; break;
      }
      const resText = `${currentLang === 'uz' ? 'Natija' : '–†–µ–∑—É–ª—å—Ç–∞—Ç'}: ${result}`;
      document.getElementById("result").textContent = resText;
      historyArr.unshift(`${num1} ${getSymbol(op)} ${num2} = ${result}`);
      document.getElementById("history").innerHTML =
        `<strong>${currentLang === 'uz' ? 'Tarix' : '–ò—Å—Ç–æ—Ä–∏—è'}:</strong><br>` +
        historyArr.slice(0, 10).join("<br>");
    }

    function getSymbol(op) {
      return { add: '+', subtract: '‚àí', multiply: '√ó', divide: '√∑' }[op];
    }

    function clearHistory() {
      historyArr.length = 0;
      document.getElementById("history").innerHTML = "";
    }

    function convertCurrency() {
      const amount = parseFloat(document.getElementById("amount").value);
      const from = document.getElementById("fromCurrency").value;
      const to = document.getElementById("toCurrency").value;
      if (!exchangeRates[from] || !exchangeRates[to]) return;
      const usdAmount = amount / exchangeRates[from];
      const converted = usdAmount * exchangeRates[to];
      document.getElementById("convertedResult").textContent = `${currentLang === 'uz' ? 'Natija' : '–†–µ–∑—É–ª—å—Ç–∞—Ç'}: ${converted.toFixed(2)} ${to}`;
    }

    window.onload = fetchRates;
  </script>
</body>
</html>
